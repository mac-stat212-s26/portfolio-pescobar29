<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>8 Missing Data ‚Äì COMP/STAT212 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../extra/extra-sample1.html" rel="next">
<link href="../ica/07-wrangling-2-notes/07-wrangling-2-notes.html" rel="prev">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-447330ed7f5b14f08626394f08367e28.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-b1525fc7443f827935229f0f56e36607.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-447330ed7f5b14f08626394f08367e28.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="../style/custom.css">
</head>
<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../ica/ica-sample1.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../ica/08-missing-data-notes.html"><span class="chapter-title">8 Missing Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/sidebar-logo.png" alt="Random negative space illustration" class="sidebar-logo light-content py-0 d-lg-inline d-none"><img src="../assets/sidebar-logo.png" alt="Random negative space illustration" class="sidebar-logo dark-content py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Patricia Escobar</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Prof Viz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pv/pv-01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Professional Viz</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">TidyTuesday</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tt/2025-07-08.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tt/2025-07-15.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tt/hw01-tt.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 01</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Pre-Class Learnings</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pcl/pcl.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Pre-Class Learning Summaries</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">In-Class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ICA Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ICA Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/cleaning.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Cleaning SFO Weather Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/06-wrangling-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 Adv Data wrangling I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/07-wrangling-2-notes/07-wrangling-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 Adv Data wrangling II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/08-missing-data-notes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">8 Missing Data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Extras</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../extra/extra-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Extra Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../extra/extra-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Extra Sample 2</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">üß© Learning Goals</a></li>
  <li><a href="#data-quality-checklist" id="toc-data-quality-checklist" class="nav-link" data-scroll-target="#data-quality-checklist">Data Quality Checklist</a></li>
  <li><a href="#explicit-v.-implicit-missing-data" id="toc-explicit-v.-implicit-missing-data" class="nav-link" data-scroll-target="#explicit-v.-implicit-missing-data">Explicit v. Implicit Missing Data</a></li>
  <li><a href="#dealing-with-missing-data" id="toc-dealing-with-missing-data" class="nav-link" data-scroll-target="#dealing-with-missing-data">Dealing with missing data</a></li>
  <li><a href="#missing-data-mechanisms" id="toc-missing-data-mechanisms" class="nav-link" data-scroll-target="#missing-data-mechanisms">Missing Data Mechanisms</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#exploring-missing-data" id="toc-exploring-missing-data" class="nav-link" data-scroll-target="#exploring-missing-data">Exploring Missing Data</a></li>
  <li><a href="#missingness-by-variable" id="toc-missingness-by-variable" class="nav-link" data-scroll-target="#missingness-by-variable">Missingness by Variable</a></li>
  <li><a href="#missingness-by-case" id="toc-missingness-by-case" class="nav-link" data-scroll-target="#missingness-by-case">Missingness by Case</a></li>
  <li><a href="#exploring-missingness-mechanisms" id="toc-exploring-missingness-mechanisms" class="nav-link" data-scroll-target="#exploring-missingness-mechanisms">Exploring Missingness Mechanisms</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#regression-imputation" id="toc-regression-imputation" class="nav-link" data-scroll-target="#regression-imputation">Regression Imputation</a></li>
  <li><a href="#simulation-studies" id="toc-simulation-studies" class="nav-link" data-scroll-target="#simulation-studies">Simulation Studies</a></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../ica/ica-sample1.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../ica/08-missing-data-notes.html"><span class="chapter-title">8 Missing Data</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">8 Missing Data</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><section id="learning-goals" class="level2"><h2 class="anchored" data-anchor-id="learning-goals">üß© Learning Goals</h2>
<p>By the end of this lesson, you should be able to:</p>
<ul>
<li>Go through a data quality checklist when data wrangling</li>
<li>Explain the difference between MCAR, MAR, and MNAR missing data mechanisms</li>
<li>Assess what missing data mechanisms might be at play in a given dataset</li>
<li>Use visualizations to explore missing data patterns</li>
<li>Explain why multiple imputation is preferred to single imputation</li>
<li>Explain how a simulation study can be used to investigate properties of statistical methods</li>
</ul></section><section id="data-quality-checklist" class="level2"><h2 class="anchored" data-anchor-id="data-quality-checklist">Data Quality Checklist</h2>
<p>When wrangling / cleaning data, make sure to check the assumptions you make about the data to ensure you don‚Äôt lose data quality.</p>
<div class="incremental">
<p><strong>Data Parsing</strong> (reading data into a different data format)</p>
<ul class="incremental">
<li>Always keep the original, raw data (don‚Äôt manually change it).</li>
<li>Use Test Cases: Find rows or write test cases to double check the wrangling works as expected</li>
<li>DATES: When using <code>lubridate</code> to parse dates and times, ensure the strings are consistently ordered and formatted correctly, eg, mm/dd/yy vs.&nbsp;dd/mm/yy.</li>
<li>STRINGS: When using <code>stringr</code> to parse strings with regular expressions, check example rows to ensure that the pattern captured all of the examples you want and excluded the patterns you don‚Äôt want.</li>
<li>Always check for missing values to see if the missing ones are expected given the original data.</li>
</ul>
</div>
<p><strong>Data Joining</strong></p>
<div class="incremental">
<ul class="incremental">
<li>Identify missing values in the key variables and decide how to handle them before the merge process (e.g., omitting rows with missing values, imputing missing values).</li>
<li>Decide on the correct join type (left, right, inner, full, etc.) OR if the data structure is the same use <code>list_rbind()</code> to bind rows or <code>list_cbind()</code> to bind columns.</li>
<li>If doing a join, make sure that the key variables (<code>by</code>) have the same meaning in both datasets and are represented in the same way (e.g., id = 1 to 20 in first dataset will match id = 1 - 20 in undesirable ways)</li>
<li>Predict the number of rows that will result from the join and double check the <code>anti_join()</code> to see which rows did not find a match.</li>
<li>Check for duplicate records within each dataset and ensure they are handled appropriately before merging.</li>
<li>Verify that the merged dataset maintains consistency with the original datasets in terms of data values, variable names, and variable types.</li>
<li>Perform some preliminary analysis or validation checks on the merged dataset to ensure that it meets the requirements of your analysis.</li>
</ul>
</div>
<p><strong>Sanity Check: Visualize your data!!!</strong></p>
<div class="incremental">
<ul class="incremental">
<li>Do the right number of points appear?</li>
<li>Do the values seem reasonable?</li>
</ul>
</div>
</section><section id="explicit-v.-implicit-missing-data" class="level2"><h2 class="anchored" data-anchor-id="explicit-v.-implicit-missing-data">Explicit v. Implicit Missing Data</h2>
<p><strong>Explicit missing data</strong> is data that is explicitly marked as missing. In R, this is done with <code>NA</code>.</p>
<p><strong>Implicit missing data</strong> is data that is missing but not explicitly marked as such.</p>
<ul>
<li>This can happen when an entire row is missing from a dataset.
<ul>
<li>For example, if a study participant doesn‚Äôt attend a follow-up visit. It maybe not even be recorded in the data.</li>
</ul>
</li>
</ul>
<p>We need to <strong>make implicit missingness explicit</strong> before we can work with the data.</p>
<ul>
<li>Consider the combinations of variables that you‚Äôd expect to be fully present in a complete dataset.
<ul>
<li>If a combination is missing, you can create a new row with explicit missing values.
<ul>
<li>For example, if you expect every participant (each has a unique <code>pid</code>) to have an observation for each <code>visit</code>, you could use the function <code>complete()</code> to create that new row and plug in values of <code>NA</code> for the missing data.</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>study_data_full &lt;- study_data |&gt; 
  complete(pid, visit)</code></pre>
</section><section id="dealing-with-missing-data" class="level2"><h2 class="anchored" data-anchor-id="dealing-with-missing-data">Dealing with missing data</h2>
<p>If you have <strong>explicit</strong> missing data, there are 3 main ways of proceeding:</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>Drop the cases or rows with any missing data from the analysis‚Äìa <strong>complete case analysis</strong>
<ul class="incremental">
<li>Pro: Easy to implement</li>
<li>Con: reduces sample size, introduces bias if the missing data is not ‚Äúmissing completely at random‚Äù</li>
</ul>
</li>
<li>Create a category for missing values.
<ul class="incremental">
<li>Example: The survey question ‚ÄúWhat is your gender?‚Äù might only provide two possible responses: ‚Äúmale‚Äù and ‚Äúfemale‚Äù. Missing values for this could indicate that the respondent uses a non-binary designation. Instead of dropping these cases, treating the missing data as its own category (‚ÄúDoes not wish to answer‚Äù) would be more appropriate.</li>
<li>Pros: Maintains sample size, may help us if data is ‚Äúmissing not at random‚Äù</li>
<li>Cons: Not directly applicable to continuous outcomes (could include interactions with a categorical version in models to account for it)</li>
</ul>
</li>
<li>
<strong>Impute</strong> (or fill in values for) the missing data using imputation algorithms.
<ul class="incremental">
<li>Imputation algorithms can be as simple as replacing missing values with the mean of the non-missing values (very simplistic).</li>
<li>Regression imputation algorithms use models to predict missing values as a function of other variables in the data.</li>
<li>Pros: Maintains sample size, multiple regression imputation minimizes bias if ‚Äúmissing at random‚Äù</li>
<li>Cons: Computationally intensive</li>
</ul>
</li>
</ol>
</div>
<p>Deciding between these options and proceeding with choosing finer details within an option requires an understanding of the <strong>mechanism</strong> by which data become missing.</p>
</section><section id="missing-data-mechanisms" class="level2"><h2 class="anchored" data-anchor-id="missing-data-mechanisms">Missing Data Mechanisms</h2>
<p>The reasons for which a variable might have missing data are divided into 3 mechanisms: MCAR, MAR, and MNAR.</p>
<p>Within a dataset, multiple mechanisms may be present‚Äìwe need to consider the missingness mechanism for each variable individually.</p>
<div class="incremental">
<ul class="incremental">
<li>
<strong>Missing completely at random (MCAR)</strong>:
<ul class="incremental">
<li>The probability of missing data for a variable is the same for all cases. Implies that causes of the missing data are unrelated to the data. (<a href="https://stefvanbuuren.name/fimd/sec-MCAR.html" class="uri">https://stefvanbuuren.name/fimd/sec-MCAR.html</a>)</li>
<li>Examples:
<ul class="incremental">
<li>Measurement device that runs out of batteries causes the remainder of observations for the day to be missing.</li>
<li>Data entry software requires a particular field to be typo-free, and missing values are introduced when there are typos.</li>
</ul>
</li>
<li>Implications for downstream work:
<ul class="incremental">
<li>If a variable has MCAR missingness, a complete case analysis will be unbiased (still valid).</li>
<li>However, with a lot of missing observations, a complete case analysis will suffer from loss of statistical power (ability to detect a real difference), and imputation will be useful to retain the original sample size.</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Missing at random (MAR):</strong>
<ul class="incremental">
<li>The probability of missing data is related to <strong>observed</strong> variables but unrelated to unobserved information.</li>
<li>Examples:
<ul class="incremental">
<li>Blood pressure measurements tend to be missing in patients in worse health. (Those in worse health are more likely to miss clinic visits.) Better and worse health can be measured by a variety of indicators in their health record.</li>
<li>In a survey, older people are more likely to report their income than younger people. Missingness is related to the observed age variable, but not to unobserved information.</li>
</ul>
</li>
<li>Implications for downstream work:
<ul class="incremental">
<li>Try to use imputation methods that predict the value of the missing variables from other observed variables. Assessing whether this can be done accurately takes some exploration‚Äìwe‚Äôll explore this shortly.</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Missing not at random (MNAR):</strong>
<ul class="incremental">
<li>The probability of missing data is related to <strong>unobserved</strong> variables (and probably observed variables too).</li>
<li>Examples:
<ul class="incremental">
<li>Blood pressure measurements are more likely to be missing for those with the highest blood pressure. This is MNAR rather than MAR because the missing data on blood pressure is related to the unobserved values themselves.</li>
<li>High-income individuals may be less likely to report their income.</li>
</ul>
</li>
<li>Implications for downstream work:
<ul class="incremental">
<li>Ideally, we would learn more about the causes for the missingness. This could allow us to use more informed imputation models.
<ul class="incremental">
<li>Example: Biological measurements that tend to be missing because of concentrations that are too low (a phenomenon known as left-censoring). Imputation methods specifically suited to left-censoring are useful here.</li>
</ul>
</li>
<li>We can use imputation methods with different assumptions about the missing data and try out a variety of assumptions. This lets us see how sensitive the results are under various scenarios.
<ul class="incremental">
<li>Example: If higher incomes are more likely to be missing, we can make different assumptions about what ‚Äúhigh‚Äù could be to fill in the missing values and see how our results change under these different assumptions.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section><section id="exercise" class="level2"><h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<ol type="1">
<li>
<strong>Missing data mechanism</strong> For each of the following situations, propose what missing data mechanism you think is most likely at play.</li>
</ol>
<ol type="a">
<li>In a clinical trial, some patients dropped out before the end of the study. Their reasons for dropping out were not recorded.</li>
<li>A weather station records temperature, humidity, and wind speed every hour. Some of the recorded values are missing.</li>
<li>A social media platform collects data on user interactions, such as likes, comments, and shares. Some interactions are not recorded due to bugs in the code.</li>
</ol></section><section id="exploring-missing-data" class="level2"><h2 class="anchored" data-anchor-id="exploring-missing-data">Exploring Missing Data</h2>
<p><strong>Guiding question:</strong> How can we use visualizations and tabulations to explore what missing data mechanisms may be at play?</p>
<p>We‚Äôll look at the <code>airquality</code> dataset available in base R, which gives daily air quality measurements in New York from May to September 1973. You can pull up the codebook with <code><a href="https://rdrr.io/r/datasets/airquality.html">?airquality</a></code> in the Console.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">data</span>(airquality)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section><section id="missingness-by-variable" class="level2"><h2 class="anchored" data-anchor-id="missingness-by-variable">Missingness by Variable</h2>
<p>We can explore how much missingness there is for each variable with the following functions:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">summary</span>(airquality) <span class="co"># Summary statistics in addition to number of NA's</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     Ozone           Solar.R           Wind             Temp      
 Min.   :  1.00   Min.   :  7.0   Min.   : 1.700   Min.   :56.00  
 1st Qu.: 18.00   1st Qu.:115.8   1st Qu.: 7.400   1st Qu.:72.00  
 Median : 31.50   Median :205.0   Median : 9.700   Median :79.00  
 Mean   : 42.13   Mean   :185.9   Mean   : 9.958   Mean   :77.88  
 3rd Qu.: 63.25   3rd Qu.:258.8   3rd Qu.:11.500   3rd Qu.:85.00  
 Max.   :168.00   Max.   :334.0   Max.   :20.700   Max.   :97.00  
 NA's   :37       NA's   :7                                       
     Month            Day      
 Min.   :5.000   Min.   : 1.0  
 1st Qu.:6.000   1st Qu.: 8.0  
 Median :7.000   Median :16.0  
 Mean   :6.993   Mean   :15.8  
 3rd Qu.:8.000   3rd Qu.:23.0  
 Max.   :9.000   Max.   :31.0  
                               </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>naniar<span class="sc">::</span><span class="fu">vis_miss</span>(airquality) <span class="co"># Where are NA's located?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_by_var-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>naniar<span class="sc">::</span><span class="fu">miss_var_summary</span>(airquality) <span class="co"># Information from vis_miss() in table form</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  variable n_miss pct_miss
  &lt;chr&gt;     &lt;int&gt;    &lt;num&gt;
1 Ozone        37    24.2 
2 Solar.R       7     4.58
3 Wind          0     0   
4 Temp          0     0   
5 Month         0     0   
6 Day           0     0   </code></pre>
</div>
</div>
</section><section id="missingness-by-case" class="level2"><h2 class="anchored" data-anchor-id="missingness-by-case">Missingness by Case</h2>
<p>We can explore how much missingness there is for each case with <code><a href="https://naniar.njtierney.com/reference/miss_case_summary.html">naniar::miss_case_summary()</a></code>. For each case, this function calculates the number and percentage of variables with a missing value.</p>
<p><strong>Impact of Information:</strong> If the <code>pct_miss</code> column is large for a case, we likely won‚Äôt be able to impute any of its missing values because there just isn‚Äôt enough known information‚Äìthis case will have to be dropped from the analysis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>naniar<span class="sc">::</span><span class="fu">miss_case_summary</span>(airquality)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 153 √ó 3
    case n_miss pct_miss
   &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1     5      2     33.3
 2    27      2     33.3
 3     6      1     16.7
 4    10      1     16.7
 5    11      1     16.7
 6    25      1     16.7
 7    26      1     16.7
 8    32      1     16.7
 9    33      1     16.7
10    34      1     16.7
# ‚Ñπ 143 more rows</code></pre>
</div>
</div>
</section><section id="exploring-missingness-mechanisms" class="level2"><h2 class="anchored" data-anchor-id="exploring-missingness-mechanisms">Exploring Missingness Mechanisms</h2>
<p>Assessing missingness mechanisms involves checking if missingness in a variable is related to other variables.</p>
<p>Note: Through our available data, we are really only able to explore the potential for MCAR or MAR mechanisms.</p>
<p><strong>Impact of Information:</strong> There is always the chance that unobserved information (unobserved other variables or unobserved values of the variables we do have) is related to missingness for our variables, so to think through the potential for MNAR, more contextual information is necessary.</p>
<p>To explore these relationships, we can create TRUE/FALSE indicators of whether a variable is missing. In the plots below, we use <code>is.na(Ozone)</code> to explore whether cases with missing ozone values are noticeably different from cases with observed ozone values in terms of <code>Solar.R</code>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">is.na</span>(Ozone), <span class="at">y =</span> Solar.R)) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="fu">geom_boxplot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_box_dens-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">color =</span> <span class="fu">is.na</span>(Ozone))) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="fu">geom_density</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_box_dens-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above boxplots and density plots suggest that missing ozone is not strongly related to solar radiation levels.</p>
<p>We still should check if ozone missingness is related to the <code>Wind</code>, <code>Temp</code>, <code>Month</code>, and <code>Day</code> variables (to be done in Exercises).</p>
<p>In addition to checking if the <em>chance</em> of ozone missingness is related to <code>Solar.R</code>, we should check if the <em>values</em> of ozone could be predicted by <code>Solar.R</code>.</p>
<p>In the scaterrplot below, we look at the relationship between <code>Ozone</code> and <code>Solar.R</code> and use vertical lines to indicate the <code>Solar.R</code> values for cases that are missing <code>Ozone</code>.</p>
<ul>
<li>
<strong>Impact of Information:</strong> We see that missing <code>Ozone</code> cases are within the observed span of <code>Solar.R</code>, so we would be ok with predicting <code>Ozone</code> from <code>Solar.R</code> because there would be no <strong>extrapolation</strong>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> airquality <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Ozone)), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> Solar.R))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_scatter_na_markers-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="exercises" class="level2"><h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<ol start="2" type="1">
<li>
<strong>Mechanism detection practice</strong> Look at the boxplot + scatterplot pairs for Alternate Situations 1 and 2 below. How do these situations compare to our actual situation and to each other? What concerns might arise from using a model to impute <code>Ozone</code>?</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_scatter_na_markers_alt-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_scatter_na_markers_alt-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_scatter_na_markers_alt-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-missing-data-notes_files/figure-html/miss_scatter_na_markers_alt-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>
<strong>Ozone mechanism detection</strong> Continue the investigation of missingness for <code>Ozone</code>.</li>
</ol>
<p>We want to see how <code>Month</code>, <code>Wind</code>, and <code>Temp</code> relate to the chance of missingness for <code>Ozone</code> and to the value of <code>Ozone</code>.</p>
<p>Does it look like a linear regression model (perhaps with variable transformations) could be effective in imputing the missing ozone data?</p>
</section><section id="regression-imputation" class="level2"><h2 class="anchored" data-anchor-id="regression-imputation">Regression Imputation</h2>
<p>When a model is built and used to generate a single set of predictions for missing values, this is known as <strong>single imputation</strong>.</p>
<ul>
<li>When using singly imputed data in subsequent modeling, the uncertainty in estimates tends to be underestimated. This means that:
<ul>
<li>Standard errors are lower than they should be.</li>
<li>Confidence intervals won‚Äôt contain the true parameter value the ‚Äúadvertised‚Äù percentage of times
<ul>
<li>e.g., 95% confidence intervals will not contain the truth in 95% of samples‚Äìthe coverage probability will be less than 95%</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In <strong>multiple imputation</strong>, multiple imputed datasets are generated with different values for the filled-in data.</p>
<ul>
<li>Subsequent models are fit on each of these datasets, and both estimates and uncertainty measures are pooled across all of these fits.</li>
<li>Multiple imputation more accurately estimates uncertainty measures.</li>
</ul></section><section id="simulation-studies" class="level2"><h2 class="anchored" data-anchor-id="simulation-studies">Simulation Studies</h2>
<p>We can use a <strong>simulation study</strong> to investigate the statistical properties described above.</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>Generate (simulate) data where we are in control of missing data mechanisms and the true relationship between an outcome and the predictors.</li>
<li>On that simulated data, use <strong>single imputation</strong> to fill in the missing values. Fit the desired model, and obtain a confidence interval for a coefficient of interest.</li>
<li>On that simulated data, use <strong>multiple imputation</strong> to fill in the missing values. Fit the desired models on all imputed datasets, pool results, and obtain a confidence interval for a coefficient of interest.</li>
<li>Steps 1 - 3 are repeated a lot of times (<code>num_simulations &lt;- 1000</code>) to see how things work out in lots of different samples.</li>
<li>Summarize the performance of single and multiple imputation across the <code>num_simulations</code> simulations.</li>
</ol>
</div>
<p>We will slowly step through the simulation study code below. We will pause frequently for you to add comments documenting what is happening.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">set.seed</span>(<span class="dv">224</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>ci_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> num_simulations)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="fu">system.time</span>({</span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="co"># Simulate data</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>    n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-10"><a href="#cb13-10"></a>        <span class="at">x1 =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>),</span>
<span id="cb13-11"><a href="#cb13-11"></a>        <span class="at">x2 =</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb13-12"><a href="#cb13-12"></a>        <span class="at">x2_miss_bool =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> x1<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb13-13"><a href="#cb13-13"></a>        <span class="at">x2_NA =</span> <span class="fu">if_else</span>(x2_miss_bool <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, x2),</span>
<span id="cb13-14"><a href="#cb13-14"></a>        <span class="at">y =</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb13-15"><a href="#cb13-15"></a>    )</span>
<span id="cb13-16"><a href="#cb13-16"></a>    </span>
<span id="cb13-17"><a href="#cb13-17"></a>    <span class="co"># Single imputation ---------------</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>    mice_obj <span class="ot">&lt;-</span> <span class="fu">mice</span>(sim_data <span class="sc">|&gt;</span> <span class="fu">select</span>(x1, x2_NA, y), <span class="at">m =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"norm"</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-19"><a href="#cb13-19"></a>    si_mod <span class="ot">&lt;-</span> <span class="fu">with</span>(mice_obj, <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2_NA))</span>
<span id="cb13-20"><a href="#cb13-20"></a>    ci_single <span class="ot">&lt;-</span> si_mod<span class="sc">$</span>analyses[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>    ci_single <span class="ot">&lt;-</span> ci_single[<span class="st">"x2_NA"</span>,]</span>
<span id="cb13-22"><a href="#cb13-22"></a>    </span>
<span id="cb13-23"><a href="#cb13-23"></a>    <span class="co"># Multiple imputation -------------</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>    mice_obj <span class="ot">&lt;-</span> <span class="fu">mice</span>(sim_data <span class="sc">|&gt;</span> <span class="fu">select</span>(x1, x2_NA, y), <span class="at">m =</span> <span class="dv">10</span>, <span class="at">method =</span> <span class="st">"norm"</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-25"><a href="#cb13-25"></a>    mi_mods <span class="ot">&lt;-</span> <span class="fu">with</span>(mice_obj, <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2_NA))</span>
<span id="cb13-26"><a href="#cb13-26"></a>    pooled_res <span class="ot">&lt;-</span> <span class="fu">pool</span>(mi_mods)</span>
<span id="cb13-27"><a href="#cb13-27"></a>    summ_pooled_res <span class="ot">&lt;-</span> <span class="fu">summary</span>(pooled_res, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb13-28"><a href="#cb13-28"></a>    ci_multiple_lower <span class="ot">&lt;-</span> summ_pooled_res <span class="sc">|&gt;</span> <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"x2_NA"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>)</span>
<span id="cb13-29"><a href="#cb13-29"></a>    ci_multiple_upper <span class="ot">&lt;-</span> summ_pooled_res <span class="sc">|&gt;</span> <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"x2_NA"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>)</span>
<span id="cb13-30"><a href="#cb13-30"></a>    </span>
<span id="cb13-31"><a href="#cb13-31"></a>    <span class="co"># Store CI information</span></span>
<span id="cb13-32"><a href="#cb13-32"></a>    ci_list[[i]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-33"><a href="#cb13-33"></a>        <span class="at">ci_lower =</span> <span class="fu">c</span>(</span>
<span id="cb13-34"><a href="#cb13-34"></a>            ci_single[<span class="dv">1</span>],</span>
<span id="cb13-35"><a href="#cb13-35"></a>            ci_multiple_lower</span>
<span id="cb13-36"><a href="#cb13-36"></a>        ),</span>
<span id="cb13-37"><a href="#cb13-37"></a>        <span class="at">ci_upper =</span> <span class="fu">c</span>(</span>
<span id="cb13-38"><a href="#cb13-38"></a>            ci_single[<span class="dv">2</span>],</span>
<span id="cb13-39"><a href="#cb13-39"></a>            ci_multiple_upper</span>
<span id="cb13-40"><a href="#cb13-40"></a>        ),</span>
<span id="cb13-41"><a href="#cb13-41"></a>        <span class="at">which_imp =</span> <span class="fu">c</span>(<span class="st">"single"</span>, <span class="st">"multiple"</span>)</span>
<span id="cb13-42"><a href="#cb13-42"></a>    )</span>
<span id="cb13-43"><a href="#cb13-43"></a>}</span>
<span id="cb13-44"><a href="#cb13-44"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
 66.402   1.092  70.240 </code></pre>
</div>
</div>
<p>Below we compute the confidence interval (CI) coverage probability (fraction of times the CI contains the true value of <code>1</code>) for the CIs generated from single and multiple imputation:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ci_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ci_list)</span>
<span id="cb15-2"><a href="#cb15-2"></a>ci_data <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="fu">mutate</span>(<span class="at">contains_truth =</span> ci_lower <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> ci_upper <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="fu">group_by</span>(which_imp) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="fu">summarize</span>(<span class="at">frac_contains_truth =</span> <span class="fu">mean</span>(contains_truth))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 2
  which_imp frac_contains_truth
  &lt;chr&gt;                   &lt;dbl&gt;
1 multiple                0.947
2 single                  0.902</code></pre>
</div>
</div>
</section><section id="done" class="level2"><h2 class="anchored" data-anchor-id="done">Done!</h2>
<ul>
<li>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../ica/07-wrangling-2-notes/07-wrangling-2-notes.html" class="pagination-link" aria-label="7 Adv Data wrangling II">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">7 Adv Data wrangling II</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../extra/extra-sample1.html" class="pagination-link" aria-label="Extra Sample 1">
        <span class="nav-page-text"><span class="chapter-title">Extra Sample 1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="an">title:</span><span class="co"> "8 Missing Data"</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">---</span></span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="in">```{r doc_setup_08, echo=FALSE, message=FALSE}</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="fu">library</span>(naniar)</span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="fu">library</span>(mice)</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="in">```</span></span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="fu">## üß© Learning Goals</span></span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a>By the end of this lesson, you should be able to:</span>
<span id="cb17-15"><a href="#cb17-15"></a></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="ss">- </span>Go through a data quality checklist when data wrangling</span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="ss">- </span>Explain the difference between MCAR, MAR, and MNAR missing data mechanisms</span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="ss">- </span>Assess what missing data mechanisms might be at play in a given dataset</span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="ss">- </span>Use visualizations to explore missing data patterns</span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="ss">- </span>Explain why multiple imputation is preferred to single imputation</span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="ss">- </span>Explain how a simulation study can be used to investigate properties of statistical methods</span>
<span id="cb17-22"><a href="#cb17-22"></a></span>
<span id="cb17-23"><a href="#cb17-23"></a></span>
<span id="cb17-24"><a href="#cb17-24"></a><span class="fu">## Data Quality Checklist </span></span>
<span id="cb17-25"><a href="#cb17-25"></a></span>
<span id="cb17-26"><a href="#cb17-26"></a>When wrangling / cleaning data, make sure to check the assumptions you make about the data to ensure you don't lose data quality.</span>
<span id="cb17-27"><a href="#cb17-27"></a></span>
<span id="cb17-28"><a href="#cb17-28"></a></span>
<span id="cb17-29"><a href="#cb17-29"></a>:::{.incremental}</span>
<span id="cb17-30"><a href="#cb17-30"></a>**Data Parsing** (reading data into a different data format)</span>
<span id="cb17-31"><a href="#cb17-31"></a></span>
<span id="cb17-32"><a href="#cb17-32"></a><span class="ss">- </span>Always keep the original, raw data (don't manually change it).</span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="ss">- </span>Use Test Cases: Find rows or write test cases to double check the wrangling works as expected</span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="ss">- </span>DATES: When using <span class="in">`lubridate`</span> to parse dates and times, ensure the strings are consistently ordered and formatted correctly, eg,  mm/dd/yy vs. dd/mm/yy. </span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="ss">- </span>STRINGS: When using <span class="in">`stringr`</span> to parse strings with regular expressions, check example rows to ensure that the pattern captured all of the examples you want and excluded the patterns you don't want.</span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="ss">- </span>Always check for missing values to see if the missing ones are expected given the original data.</span>
<span id="cb17-37"><a href="#cb17-37"></a></span>
<span id="cb17-38"><a href="#cb17-38"></a>:::</span>
<span id="cb17-39"><a href="#cb17-39"></a></span>
<span id="cb17-40"><a href="#cb17-40"></a>**Data Joining**</span>
<span id="cb17-41"><a href="#cb17-41"></a></span>
<span id="cb17-42"><a href="#cb17-42"></a>:::{.incremental}</span>
<span id="cb17-43"><a href="#cb17-43"></a></span>
<span id="cb17-44"><a href="#cb17-44"></a><span class="ss">- </span>Identify missing values in the key variables and decide how to handle them before the merge process (e.g., omitting rows with missing values, imputing missing values).</span>
<span id="cb17-45"><a href="#cb17-45"></a><span class="ss">- </span>Decide on the correct join type (left, right, inner, full, etc.) OR if the data structure is the same use <span class="in">`list_rbind()`</span> to bind rows or <span class="in">`list_cbind()`</span> to bind columns.</span>
<span id="cb17-46"><a href="#cb17-46"></a><span class="ss">- </span>If doing a join, make sure that the key variables (<span class="in">`by`</span>) have the same meaning in both datasets and are represented in the same way (e.g., id = 1 to 20 in first dataset will match id = 1 - 20 in undesirable ways)</span>
<span id="cb17-47"><a href="#cb17-47"></a><span class="ss">- </span>Predict the number of rows that will result from the join and double check the <span class="in">`anti_join()`</span> to see which rows did not find a match.</span>
<span id="cb17-48"><a href="#cb17-48"></a><span class="ss">- </span>Check for duplicate records within each dataset and ensure they are handled appropriately before merging.</span>
<span id="cb17-49"><a href="#cb17-49"></a><span class="ss">- </span>Verify that the merged dataset maintains consistency with the original datasets in terms of data values, variable names, and variable types.</span>
<span id="cb17-50"><a href="#cb17-50"></a><span class="ss">- </span>Perform some preliminary analysis or validation checks on the merged dataset to ensure that it meets the requirements of your analysis.</span>
<span id="cb17-51"><a href="#cb17-51"></a></span>
<span id="cb17-52"><a href="#cb17-52"></a>:::</span>
<span id="cb17-53"><a href="#cb17-53"></a></span>
<span id="cb17-54"><a href="#cb17-54"></a></span>
<span id="cb17-55"><a href="#cb17-55"></a>**Sanity Check: Visualize your data!!!**</span>
<span id="cb17-56"><a href="#cb17-56"></a></span>
<span id="cb17-57"><a href="#cb17-57"></a>:::{.incremental}</span>
<span id="cb17-58"><a href="#cb17-58"></a><span class="ss">- </span>Do the right number of points appear?</span>
<span id="cb17-59"><a href="#cb17-59"></a><span class="ss">- </span>Do the values seem reasonable?</span>
<span id="cb17-60"><a href="#cb17-60"></a>:::</span>
<span id="cb17-61"><a href="#cb17-61"></a></span>
<span id="cb17-62"><a href="#cb17-62"></a><span class="fu">## Explicit v. Implicit Missing Data </span></span>
<span id="cb17-63"><a href="#cb17-63"></a></span>
<span id="cb17-64"><a href="#cb17-64"></a>**Explicit missing data** is data that is explicitly marked as missing. In R, this is done with <span class="in">`NA`</span>.</span>
<span id="cb17-65"><a href="#cb17-65"></a></span>
<span id="cb17-66"><a href="#cb17-66"></a></span>
<span id="cb17-67"><a href="#cb17-67"></a>**Implicit missing data** is data that is missing but not explicitly marked as such. </span>
<span id="cb17-68"><a href="#cb17-68"></a></span>
<span id="cb17-69"><a href="#cb17-69"></a><span class="ss">- </span>This can happen when an entire row is missing from a dataset. </span>
<span id="cb17-70"><a href="#cb17-70"></a><span class="ss">    - </span>For example, if a study participant doesn't attend a follow-up visit. It maybe not even be recorded in the data.</span>
<span id="cb17-71"><a href="#cb17-71"></a></span>
<span id="cb17-72"><a href="#cb17-72"></a>We need to **make implicit missingness explicit** before we can work with the data. </span>
<span id="cb17-73"><a href="#cb17-73"></a></span>
<span id="cb17-74"><a href="#cb17-74"></a><span class="ss">- </span>Consider the combinations of variables that you'd expect to be fully present in a complete dataset. </span>
<span id="cb17-75"><a href="#cb17-75"></a><span class="ss">    - </span>If a combination is missing, you can create a new row with explicit missing values. </span>
<span id="cb17-76"><a href="#cb17-76"></a><span class="ss">      - </span>For example, if you expect every participant (each has a unique <span class="in">`pid`</span>) to have an observation for each <span class="in">`visit`</span>, you could use the function <span class="in">`complete()`</span> to create that new row and plug in values of <span class="in">`NA`</span> for the missing data.</span>
<span id="cb17-77"><a href="#cb17-77"></a></span>
<span id="cb17-78"><a href="#cb17-78"></a><span class="in">```</span></span>
<span id="cb17-79"><a href="#cb17-79"></a><span class="in">study_data_full &lt;- study_data |&gt; </span></span>
<span id="cb17-80"><a href="#cb17-80"></a><span class="in">  complete(pid, visit)</span></span>
<span id="cb17-81"><a href="#cb17-81"></a><span class="in">```</span></span>
<span id="cb17-82"><a href="#cb17-82"></a></span>
<span id="cb17-83"><a href="#cb17-83"></a><span class="fu">## Dealing with missing data </span></span>
<span id="cb17-84"><a href="#cb17-84"></a></span>
<span id="cb17-85"><a href="#cb17-85"></a>If you have **explicit** missing data, there are 3 main ways of proceeding:</span>
<span id="cb17-86"><a href="#cb17-86"></a></span>
<span id="cb17-87"><a href="#cb17-87"></a>::: {.incremental}</span>
<span id="cb17-88"><a href="#cb17-88"></a></span>
<span id="cb17-89"><a href="#cb17-89"></a><span class="ss">1. </span>Drop the cases or rows with any missing data from the analysis--a **complete case analysis**</span>
<span id="cb17-90"><a href="#cb17-90"></a><span class="ss">    -  </span>Pro: Easy to implement</span>
<span id="cb17-91"><a href="#cb17-91"></a><span class="ss">    -  </span>Con: reduces sample size, introduces bias if the missing data is not "missing completely at random" </span>
<span id="cb17-92"><a href="#cb17-92"></a>    </span>
<span id="cb17-93"><a href="#cb17-93"></a><span class="ss">2. </span>Create a category for missing values.</span>
<span id="cb17-94"><a href="#cb17-94"></a><span class="ss">    - </span>Example: The survey question "What is your gender?" might only provide two possible responses: "male" and "female". Missing values for this could indicate that the respondent uses a non-binary designation. Instead of dropping these cases, treating the missing data as its own category ("Does not wish to answer") would be more appropriate.</span>
<span id="cb17-95"><a href="#cb17-95"></a><span class="ss">    - </span>Pros: Maintains sample size, may help us if data is "missing not at random"</span>
<span id="cb17-96"><a href="#cb17-96"></a><span class="ss">    - </span>Cons: Not directly applicable to continuous outcomes (could include interactions with a categorical version in models to account for it)</span>
<span id="cb17-97"><a href="#cb17-97"></a>    </span>
<span id="cb17-98"><a href="#cb17-98"></a><span class="ss">3. </span>**Impute** (or fill in values for) the missing data using imputation algorithms.</span>
<span id="cb17-99"><a href="#cb17-99"></a><span class="ss">    - </span>Imputation algorithms can be as simple as replacing missing values with the mean of the non-missing values (very simplistic).</span>
<span id="cb17-100"><a href="#cb17-100"></a><span class="ss">    - </span>Regression imputation algorithms use models to predict missing values as a function of other variables in the data.</span>
<span id="cb17-101"><a href="#cb17-101"></a><span class="ss">    - </span>Pros: Maintains sample size, multiple regression imputation minimizes bias if "missing at random" </span>
<span id="cb17-102"><a href="#cb17-102"></a><span class="ss">    - </span>Cons: Computationally intensive</span>
<span id="cb17-103"><a href="#cb17-103"></a>:::</span>
<span id="cb17-104"><a href="#cb17-104"></a></span>
<span id="cb17-105"><a href="#cb17-105"></a></span>
<span id="cb17-106"><a href="#cb17-106"></a>Deciding between these options and proceeding with choosing finer details within an option requires an understanding of the **mechanism** by which data become missing.</span>
<span id="cb17-107"><a href="#cb17-107"></a></span>
<span id="cb17-108"><a href="#cb17-108"></a></span>
<span id="cb17-109"><a href="#cb17-109"></a></span>
<span id="cb17-110"><a href="#cb17-110"></a><span class="fu">## Missing Data Mechanisms </span></span>
<span id="cb17-111"><a href="#cb17-111"></a></span>
<span id="cb17-112"><a href="#cb17-112"></a>The reasons for which a variable might have missing data are divided into 3 mechanisms: MCAR, MAR, and MNAR. </span>
<span id="cb17-113"><a href="#cb17-113"></a></span>
<span id="cb17-114"><a href="#cb17-114"></a>Within a dataset, multiple mechanisms may be present--we need to consider the missingness mechanism for each variable individually.</span>
<span id="cb17-115"><a href="#cb17-115"></a></span>
<span id="cb17-116"><a href="#cb17-116"></a>::: {.incremental}</span>
<span id="cb17-117"><a href="#cb17-117"></a><span class="ss">- </span>**Missing completely at random (MCAR)**:</span>
<span id="cb17-118"><a href="#cb17-118"></a><span class="ss">    - </span>The probability of missing data for a variable is the same for all cases. Implies that causes of the missing data are unrelated to the data. (<span class="ot">&lt;https://stefvanbuuren.name/fimd/sec-MCAR.html&gt;</span>)</span>
<span id="cb17-119"><a href="#cb17-119"></a><span class="ss">    - </span>Examples:</span>
<span id="cb17-120"><a href="#cb17-120"></a><span class="ss">        - </span>Measurement device that runs out of batteries causes the remainder of observations for the day to be missing.</span>
<span id="cb17-121"><a href="#cb17-121"></a><span class="ss">        - </span>Data entry software requires a particular field to be typo-free, and missing values are introduced when there are typos.</span>
<span id="cb17-122"><a href="#cb17-122"></a><span class="ss">    - </span>Implications for downstream work:</span>
<span id="cb17-123"><a href="#cb17-123"></a><span class="ss">        - </span>If a variable has MCAR missingness, a complete case analysis will be unbiased (still valid).</span>
<span id="cb17-124"><a href="#cb17-124"></a><span class="ss">        - </span>However, with a lot of missing observations, a complete case analysis will suffer from loss of statistical power (ability to detect a real difference), and imputation will be useful to retain the original sample size.</span>
<span id="cb17-125"><a href="#cb17-125"></a></span>
<span id="cb17-126"><a href="#cb17-126"></a><span class="ss">- </span>**Missing at random (MAR):**</span>
<span id="cb17-127"><a href="#cb17-127"></a><span class="ss">    - </span>The probability of missing data is related to **observed** variables but unrelated to unobserved information.</span>
<span id="cb17-128"><a href="#cb17-128"></a><span class="ss">    - </span>Examples:</span>
<span id="cb17-129"><a href="#cb17-129"></a><span class="ss">        - </span>Blood pressure measurements tend to be missing in patients in worse health. (Those in worse health are more likely to miss clinic visits.) Better and worse health can be measured by a variety of indicators in their health record.</span>
<span id="cb17-130"><a href="#cb17-130"></a><span class="ss">        - </span>In a survey, older people are more likely to report their income than younger people. Missingness is related to the observed age variable, but not to unobserved information.</span>
<span id="cb17-131"><a href="#cb17-131"></a><span class="ss">    - </span>Implications for downstream work:</span>
<span id="cb17-132"><a href="#cb17-132"></a><span class="ss">        - </span>Try to use imputation methods that predict the value of the missing variables from other observed variables. Assessing whether this can be done accurately takes some exploration--we'll explore this shortly.</span>
<span id="cb17-133"><a href="#cb17-133"></a></span>
<span id="cb17-134"><a href="#cb17-134"></a><span class="ss">- </span>**Missing not at random (MNAR):**</span>
<span id="cb17-135"><a href="#cb17-135"></a><span class="ss">    - </span>The probability of missing data is related to **unobserved** variables (and probably observed variables too).</span>
<span id="cb17-136"><a href="#cb17-136"></a><span class="ss">    - </span>Examples:</span>
<span id="cb17-137"><a href="#cb17-137"></a><span class="ss">        - </span>Blood pressure measurements are more likely to be missing for those with the highest blood pressure. This is MNAR rather than MAR because the missing data on blood pressure is related to the unobserved values themselves.</span>
<span id="cb17-138"><a href="#cb17-138"></a><span class="ss">        - </span>High-income individuals may be less likely to report their income.</span>
<span id="cb17-139"><a href="#cb17-139"></a><span class="ss">    - </span>Implications for downstream work:</span>
<span id="cb17-140"><a href="#cb17-140"></a><span class="ss">        - </span>Ideally, we would learn more about the causes for the missingness. This could allow us to use more informed imputation models.</span>
<span id="cb17-141"><a href="#cb17-141"></a><span class="ss">            - </span>Example: Biological measurements that tend to be missing because of concentrations that are too low (a phenomenon known as left-censoring). Imputation methods specifically suited to left-censoring are useful here.</span>
<span id="cb17-142"><a href="#cb17-142"></a><span class="ss">        - </span>We can use imputation methods with different assumptions about the missing data and try out a variety of assumptions. This lets us see how sensitive the results are under various scenarios.</span>
<span id="cb17-143"><a href="#cb17-143"></a><span class="ss">            - </span>Example: If higher incomes are more likely to be missing, we can make different assumptions about what "high" could be to fill in the missing values and see how our results change under these different assumptions.</span>
<span id="cb17-144"><a href="#cb17-144"></a></span>
<span id="cb17-145"><a href="#cb17-145"></a>:::</span>
<span id="cb17-146"><a href="#cb17-146"></a></span>
<span id="cb17-147"><a href="#cb17-147"></a><span class="fu">## Exercise </span></span>
<span id="cb17-148"><a href="#cb17-148"></a></span>
<span id="cb17-149"><a href="#cb17-149"></a><span class="ss">1. </span>**Missing data mechanism** For each of the following situations, propose what missing data mechanism you think is most likely at play. </span>
<span id="cb17-150"><a href="#cb17-150"></a>  a. In a clinical trial, some patients dropped out before the end of the study. Their reasons for dropping out were not recorded.</span>
<span id="cb17-151"><a href="#cb17-151"></a>  b. A weather station records temperature, humidity, and wind speed every hour. Some of the recorded values are missing.</span>
<span id="cb17-152"><a href="#cb17-152"></a>  c. A social media platform collects data on user interactions, such as likes, comments, and shares. Some interactions are not recorded due to bugs in the code.</span>
<span id="cb17-153"><a href="#cb17-153"></a></span>
<span id="cb17-154"><a href="#cb17-154"></a></span>
<span id="cb17-155"><a href="#cb17-155"></a></span>
<span id="cb17-156"><a href="#cb17-156"></a><span class="fu">## Exploring Missing Data </span></span>
<span id="cb17-157"><a href="#cb17-157"></a></span>
<span id="cb17-158"><a href="#cb17-158"></a>**Guiding question:** How can we use visualizations and tabulations to explore what missing data mechanisms may be at play?</span>
<span id="cb17-159"><a href="#cb17-159"></a></span>
<span id="cb17-160"><a href="#cb17-160"></a>We'll look at the <span class="in">`airquality`</span> dataset available in base R, which gives daily air quality measurements in New York from May to September 1973. You can pull up the codebook with <span class="in">`?airquality`</span> in the Console.</span>
<span id="cb17-161"><a href="#cb17-161"></a></span>
<span id="cb17-162"><a href="#cb17-162"></a><span class="in">```{r load_airqual}</span></span>
<span id="cb17-163"><a href="#cb17-163"></a><span class="co">#| eval: true</span></span>
<span id="cb17-164"><a href="#cb17-164"></a><span class="fu">data</span>(airquality)</span>
<span id="cb17-165"><a href="#cb17-165"></a><span class="in">```</span></span>
<span id="cb17-166"><a href="#cb17-166"></a></span>
<span id="cb17-167"><a href="#cb17-167"></a><span class="fu">## Missingness by Variable </span></span>
<span id="cb17-168"><a href="#cb17-168"></a></span>
<span id="cb17-169"><a href="#cb17-169"></a>We can explore how much missingness there is for each variable with the following functions:</span>
<span id="cb17-170"><a href="#cb17-170"></a></span>
<span id="cb17-171"><a href="#cb17-171"></a><span class="in">```{r miss_by_var}</span></span>
<span id="cb17-172"><a href="#cb17-172"></a><span class="co">#| eval: true</span></span>
<span id="cb17-173"><a href="#cb17-173"></a><span class="fu">summary</span>(airquality) <span class="co"># Summary statistics in addition to number of NA's</span></span>
<span id="cb17-174"><a href="#cb17-174"></a>naniar<span class="sc">::</span><span class="fu">vis_miss</span>(airquality) <span class="co"># Where are NA's located?</span></span>
<span id="cb17-175"><a href="#cb17-175"></a>naniar<span class="sc">::</span><span class="fu">miss_var_summary</span>(airquality) <span class="co"># Information from vis_miss() in table form</span></span>
<span id="cb17-176"><a href="#cb17-176"></a><span class="in">```</span></span>
<span id="cb17-177"><a href="#cb17-177"></a></span>
<span id="cb17-178"><a href="#cb17-178"></a><span class="fu">## Missingness by Case </span></span>
<span id="cb17-179"><a href="#cb17-179"></a></span>
<span id="cb17-180"><a href="#cb17-180"></a>We can explore how much missingness there is for each case with <span class="in">`naniar::miss_case_summary()`</span>. </span>
<span id="cb17-181"><a href="#cb17-181"></a>For each case, this function calculates the number and percentage of variables with a missing value. </span>
<span id="cb17-182"><a href="#cb17-182"></a></span>
<span id="cb17-183"><a href="#cb17-183"></a></span>
<span id="cb17-184"><a href="#cb17-184"></a>**Impact of Information:** If the <span class="in">`pct_miss`</span> column is large for a case, we likely won't be able to impute any of its missing values because there just isn't enough known information--this case will have to be dropped from the analysis.</span>
<span id="cb17-185"><a href="#cb17-185"></a></span>
<span id="cb17-186"><a href="#cb17-186"></a><span class="in">```{r miss_by_case}</span></span>
<span id="cb17-187"><a href="#cb17-187"></a><span class="co">#| eval: true</span></span>
<span id="cb17-188"><a href="#cb17-188"></a>naniar<span class="sc">::</span><span class="fu">miss_case_summary</span>(airquality)</span>
<span id="cb17-189"><a href="#cb17-189"></a><span class="in">```</span></span>
<span id="cb17-190"><a href="#cb17-190"></a></span>
<span id="cb17-191"><a href="#cb17-191"></a><span class="fu">## Exploring Missingness Mechanisms </span></span>
<span id="cb17-192"><a href="#cb17-192"></a></span>
<span id="cb17-193"><a href="#cb17-193"></a>Assessing missingness mechanisms involves checking if missingness in a variable is related to other variables. </span>
<span id="cb17-194"><a href="#cb17-194"></a></span>
<span id="cb17-195"><a href="#cb17-195"></a>Note: Through our available data, we are really only able to explore the potential for MCAR or MAR mechanisms. </span>
<span id="cb17-196"><a href="#cb17-196"></a></span>
<span id="cb17-197"><a href="#cb17-197"></a></span>
<span id="cb17-198"><a href="#cb17-198"></a></span>
<span id="cb17-199"><a href="#cb17-199"></a>**Impact of Information:** There is always the chance that unobserved information (unobserved other variables or unobserved values of the variables we do have) is related to missingness for our variables, so to think through the potential for MNAR, more contextual information is necessary.</span>
<span id="cb17-200"><a href="#cb17-200"></a></span>
<span id="cb17-201"><a href="#cb17-201"></a></span>
<span id="cb17-202"><a href="#cb17-202"></a></span>
<span id="cb17-203"><a href="#cb17-203"></a>To explore these relationships, we can create TRUE/FALSE indicators of whether a variable is missing. In the plots below, we use <span class="in">`is.na(Ozone)`</span> to explore whether cases with missing ozone values are noticeably different from cases with observed ozone values in terms of <span class="in">`Solar.R`</span>.</span>
<span id="cb17-204"><a href="#cb17-204"></a></span>
<span id="cb17-205"><a href="#cb17-205"></a><span class="in">```{r miss_box_dens}</span></span>
<span id="cb17-206"><a href="#cb17-206"></a><span class="co">#| eval: true</span></span>
<span id="cb17-207"><a href="#cb17-207"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">is.na</span>(Ozone), <span class="at">y =</span> Solar.R)) <span class="sc">+</span> </span>
<span id="cb17-208"><a href="#cb17-208"></a>    <span class="fu">geom_boxplot</span>()</span>
<span id="cb17-209"><a href="#cb17-209"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">color =</span> <span class="fu">is.na</span>(Ozone))) <span class="sc">+</span> </span>
<span id="cb17-210"><a href="#cb17-210"></a>    <span class="fu">geom_density</span>()</span>
<span id="cb17-211"><a href="#cb17-211"></a><span class="in">```</span></span>
<span id="cb17-212"><a href="#cb17-212"></a></span>
<span id="cb17-213"><a href="#cb17-213"></a>The above boxplots and density plots suggest that missing ozone is not strongly related to solar radiation levels. </span>
<span id="cb17-214"><a href="#cb17-214"></a></span>
<span id="cb17-215"><a href="#cb17-215"></a></span>
<span id="cb17-216"><a href="#cb17-216"></a>We still should check if ozone missingness is related to the <span class="in">`Wind`</span>, <span class="in">`Temp`</span>, <span class="in">`Month`</span>, and <span class="in">`Day`</span> variables (to be done in Exercises).</span>
<span id="cb17-217"><a href="#cb17-217"></a></span>
<span id="cb17-218"><a href="#cb17-218"></a></span>
<span id="cb17-219"><a href="#cb17-219"></a></span>
<span id="cb17-220"><a href="#cb17-220"></a>In addition to checking if the *chance* of ozone missingness is related to `Solar.R`, we should check if the *values* of ozone could be predicted by <span class="in">`Solar.R`</span>. </span>
<span id="cb17-221"><a href="#cb17-221"></a></span>
<span id="cb17-222"><a href="#cb17-222"></a></span>
<span id="cb17-223"><a href="#cb17-223"></a>In the scaterrplot below, we look at the relationship between <span class="in">`Ozone`</span> and <span class="in">`Solar.R`</span> and use vertical lines to indicate the <span class="in">`Solar.R`</span> values for cases that are missing <span class="in">`Ozone`</span>.</span>
<span id="cb17-224"><a href="#cb17-224"></a></span>
<span id="cb17-225"><a href="#cb17-225"></a><span class="ss">- </span>**Impact of Information:** We see that missing `Ozone` cases are within the observed span of `Solar.R`, so we would be ok with predicting `Ozone` from `Solar.R` because there would be no **extrapolation**.</span>
<span id="cb17-226"><a href="#cb17-226"></a></span>
<span id="cb17-227"><a href="#cb17-227"></a><span class="in">```{r miss_scatter_na_markers}</span></span>
<span id="cb17-228"><a href="#cb17-228"></a><span class="co">#| eval: true</span></span>
<span id="cb17-229"><a href="#cb17-229"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb17-230"><a href="#cb17-230"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-231"><a href="#cb17-231"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-232"><a href="#cb17-232"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> airquality <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Ozone)), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> Solar.R))</span>
<span id="cb17-233"><a href="#cb17-233"></a><span class="in">```</span></span>
<span id="cb17-234"><a href="#cb17-234"></a></span>
<span id="cb17-235"><a href="#cb17-235"></a></span>
<span id="cb17-236"><a href="#cb17-236"></a></span>
<span id="cb17-237"><a href="#cb17-237"></a><span class="fu">## Exercises </span></span>
<span id="cb17-238"><a href="#cb17-238"></a></span>
<span id="cb17-239"><a href="#cb17-239"></a><span class="ss">2. </span>**Mechanism detection practice** Look at the boxplot + scatterplot pairs for Alternate Situations 1 and 2 below. How do these situations compare to our actual situation and to each other? What concerns might arise from using a model to impute <span class="in">`Ozone`</span>?</span>
<span id="cb17-240"><a href="#cb17-240"></a></span>
<span id="cb17-241"><a href="#cb17-241"></a><span class="in">```{r miss_scatter_na_markers_alt}</span></span>
<span id="cb17-242"><a href="#cb17-242"></a><span class="co">#| eval: true</span></span>
<span id="cb17-243"><a href="#cb17-243"></a><span class="co">#| echo: false</span></span>
<span id="cb17-244"><a href="#cb17-244"></a>airquality_mod <span class="ot">&lt;-</span> airquality <span class="sc">|&gt;</span> </span>
<span id="cb17-245"><a href="#cb17-245"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-246"><a href="#cb17-246"></a>        <span class="at">Solar.R_mod1 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Ozone), <span class="dv">250</span> <span class="sc">+</span> Solar.R<span class="sc">/</span><span class="dv">4</span>, Solar.R),</span>
<span id="cb17-247"><a href="#cb17-247"></a>        <span class="at">Solar.R_mod2 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Ozone), <span class="dv">250</span> <span class="sc">+</span> Solar.R<span class="sc">/</span><span class="dv">2</span>, Solar.R)</span>
<span id="cb17-248"><a href="#cb17-248"></a>    )</span>
<span id="cb17-249"><a href="#cb17-249"></a></span>
<span id="cb17-250"><a href="#cb17-250"></a><span class="fu">ggplot</span>(airquality_mod, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">is.na</span>(Ozone), <span class="at">y =</span> Solar.R_mod1)) <span class="sc">+</span> </span>
<span id="cb17-251"><a href="#cb17-251"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb17-252"><a href="#cb17-252"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Alternate Situation 1"</span>)</span>
<span id="cb17-253"><a href="#cb17-253"></a><span class="fu">ggplot</span>(airquality_mod, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R_mod1, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb17-254"><a href="#cb17-254"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-255"><a href="#cb17-255"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-256"><a href="#cb17-256"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> airquality_mod <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Ozone)), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> Solar.R_mod1)) <span class="sc">+</span></span>
<span id="cb17-257"><a href="#cb17-257"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Alternate Situation 1"</span>)</span>
<span id="cb17-258"><a href="#cb17-258"></a></span>
<span id="cb17-259"><a href="#cb17-259"></a><span class="fu">ggplot</span>(airquality_mod, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">is.na</span>(Ozone), <span class="at">y =</span> Solar.R_mod2)) <span class="sc">+</span> </span>
<span id="cb17-260"><a href="#cb17-260"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb17-261"><a href="#cb17-261"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Alternate Situation 2"</span>)</span>
<span id="cb17-262"><a href="#cb17-262"></a><span class="fu">ggplot</span>(airquality_mod, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R_mod2, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb17-263"><a href="#cb17-263"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-264"><a href="#cb17-264"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-265"><a href="#cb17-265"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> airquality_mod <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Ozone)), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> Solar.R_mod2)) <span class="sc">+</span></span>
<span id="cb17-266"><a href="#cb17-266"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Alternate Situation 2"</span>)</span>
<span id="cb17-267"><a href="#cb17-267"></a><span class="in">```</span></span>
<span id="cb17-268"><a href="#cb17-268"></a></span>
<span id="cb17-269"><a href="#cb17-269"></a><span class="ss">3. </span>**Ozone mechanism detection** Continue the investigation of missingness for <span class="in">`Ozone`</span>. </span>
<span id="cb17-270"><a href="#cb17-270"></a></span>
<span id="cb17-271"><a href="#cb17-271"></a>We want to see how <span class="in">`Month`</span>, <span class="in">`Wind`</span>, and <span class="in">`Temp`</span> relate to the chance of missingness for <span class="in">`Ozone`</span> and to the value of <span class="in">`Ozone`</span>.</span>
<span id="cb17-272"><a href="#cb17-272"></a></span>
<span id="cb17-273"><a href="#cb17-273"></a>Does it look like a linear regression model (perhaps with variable transformations) could be effective in imputing the missing ozone data?</span>
<span id="cb17-274"><a href="#cb17-274"></a></span>
<span id="cb17-277"><a href="#cb17-277"></a><span class="in">```{r}</span></span>
<span id="cb17-278"><a href="#cb17-278"></a><span class="in">```</span></span>
<span id="cb17-279"><a href="#cb17-279"></a></span>
<span id="cb17-280"><a href="#cb17-280"></a></span>
<span id="cb17-281"><a href="#cb17-281"></a></span>
<span id="cb17-282"><a href="#cb17-282"></a><span class="fu">## Regression Imputation </span></span>
<span id="cb17-283"><a href="#cb17-283"></a></span>
<span id="cb17-284"><a href="#cb17-284"></a>When a model is built and used to generate a single set of predictions for missing values, this is known as **single imputation**. </span>
<span id="cb17-285"><a href="#cb17-285"></a></span>
<span id="cb17-286"><a href="#cb17-286"></a></span>
<span id="cb17-287"><a href="#cb17-287"></a><span class="ss">- </span>When using singly imputed data in subsequent modeling, the uncertainty in estimates tends to be underestimated. This means that:</span>
<span id="cb17-288"><a href="#cb17-288"></a><span class="ss">    - </span>Standard errors are lower than they should be.</span>
<span id="cb17-289"><a href="#cb17-289"></a><span class="ss">    - </span>Confidence intervals won't contain the true parameter value the "advertised" percentage of times</span>
<span id="cb17-290"><a href="#cb17-290"></a><span class="ss">        - </span>e.g., 95% confidence intervals will not contain the truth in 95% of samples--the coverage probability will be less than 95%</span>
<span id="cb17-291"><a href="#cb17-291"></a></span>
<span id="cb17-292"><a href="#cb17-292"></a></span>
<span id="cb17-293"><a href="#cb17-293"></a>In **multiple imputation**, multiple imputed datasets are generated with different values for the filled-in data. </span>
<span id="cb17-294"><a href="#cb17-294"></a></span>
<span id="cb17-295"><a href="#cb17-295"></a></span>
<span id="cb17-296"><a href="#cb17-296"></a><span class="ss">- </span>Subsequent models are fit on each of these datasets, and both estimates and uncertainty measures are pooled across all of these fits. </span>
<span id="cb17-297"><a href="#cb17-297"></a><span class="ss">- </span>Multiple imputation more accurately estimates uncertainty measures.</span>
<span id="cb17-298"><a href="#cb17-298"></a></span>
<span id="cb17-299"><a href="#cb17-299"></a><span class="fu">## Simulation Studies </span></span>
<span id="cb17-300"><a href="#cb17-300"></a></span>
<span id="cb17-301"><a href="#cb17-301"></a>We can use a **simulation study** to investigate the statistical properties described above.</span>
<span id="cb17-302"><a href="#cb17-302"></a></span>
<span id="cb17-303"><a href="#cb17-303"></a>::: {.incremental}</span>
<span id="cb17-304"><a href="#cb17-304"></a></span>
<span id="cb17-305"><a href="#cb17-305"></a><span class="ss">1. </span>Generate (simulate) data where we are in control of missing data mechanisms and the true relationship between an outcome and the predictors.</span>
<span id="cb17-306"><a href="#cb17-306"></a><span class="ss">2. </span>On that simulated data, use **single imputation** to fill in the missing values. Fit the desired model, and obtain a confidence interval for a coefficient of interest.</span>
<span id="cb17-307"><a href="#cb17-307"></a><span class="ss">3. </span>On that simulated data, use **multiple imputation** to fill in the missing values. Fit the desired models on all imputed datasets, pool results, and obtain a confidence interval for a coefficient of interest.</span>
<span id="cb17-308"><a href="#cb17-308"></a><span class="ss">4. </span>Steps 1 - 3 are repeated a lot of times (<span class="in">`num_simulations &lt;- 1000`</span>) to see how things work out in lots of different samples.</span>
<span id="cb17-309"><a href="#cb17-309"></a><span class="ss">5. </span>Summarize the performance of single and multiple imputation across the <span class="in">`num_simulations`</span> simulations.</span>
<span id="cb17-310"><a href="#cb17-310"></a></span>
<span id="cb17-311"><a href="#cb17-311"></a>:::</span>
<span id="cb17-312"><a href="#cb17-312"></a></span>
<span id="cb17-313"><a href="#cb17-313"></a>We will slowly step through the simulation study code below. We will pause frequently for you to add comments documenting what is happening. </span>
<span id="cb17-314"><a href="#cb17-314"></a></span>
<span id="cb17-315"><a href="#cb17-315"></a><span class="in">```{r mult_single_sim_study}</span></span>
<span id="cb17-316"><a href="#cb17-316"></a><span class="fu">set.seed</span>(<span class="dv">224</span>)</span>
<span id="cb17-317"><a href="#cb17-317"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb17-318"><a href="#cb17-318"></a>ci_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> num_simulations)</span>
<span id="cb17-319"><a href="#cb17-319"></a></span>
<span id="cb17-320"><a href="#cb17-320"></a><span class="fu">system.time</span>({</span>
<span id="cb17-321"><a href="#cb17-321"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb17-322"><a href="#cb17-322"></a>    <span class="co"># Simulate data</span></span>
<span id="cb17-323"><a href="#cb17-323"></a>    n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb17-324"><a href="#cb17-324"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-325"><a href="#cb17-325"></a>        <span class="at">x1 =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>),</span>
<span id="cb17-326"><a href="#cb17-326"></a>        <span class="at">x2 =</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb17-327"><a href="#cb17-327"></a>        <span class="at">x2_miss_bool =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> x1<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb17-328"><a href="#cb17-328"></a>        <span class="at">x2_NA =</span> <span class="fu">if_else</span>(x2_miss_bool <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, x2),</span>
<span id="cb17-329"><a href="#cb17-329"></a>        <span class="at">y =</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb17-330"><a href="#cb17-330"></a>    )</span>
<span id="cb17-331"><a href="#cb17-331"></a>    </span>
<span id="cb17-332"><a href="#cb17-332"></a>    <span class="co"># Single imputation ---------------</span></span>
<span id="cb17-333"><a href="#cb17-333"></a>    mice_obj <span class="ot">&lt;-</span> <span class="fu">mice</span>(sim_data <span class="sc">|&gt;</span> <span class="fu">select</span>(x1, x2_NA, y), <span class="at">m =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"norm"</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-334"><a href="#cb17-334"></a>    si_mod <span class="ot">&lt;-</span> <span class="fu">with</span>(mice_obj, <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2_NA))</span>
<span id="cb17-335"><a href="#cb17-335"></a>    ci_single <span class="ot">&lt;-</span> si_mod<span class="sc">$</span>analyses[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb17-336"><a href="#cb17-336"></a>    ci_single <span class="ot">&lt;-</span> ci_single[<span class="st">"x2_NA"</span>,]</span>
<span id="cb17-337"><a href="#cb17-337"></a>    </span>
<span id="cb17-338"><a href="#cb17-338"></a>    <span class="co"># Multiple imputation -------------</span></span>
<span id="cb17-339"><a href="#cb17-339"></a>    mice_obj <span class="ot">&lt;-</span> <span class="fu">mice</span>(sim_data <span class="sc">|&gt;</span> <span class="fu">select</span>(x1, x2_NA, y), <span class="at">m =</span> <span class="dv">10</span>, <span class="at">method =</span> <span class="st">"norm"</span>, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-340"><a href="#cb17-340"></a>    mi_mods <span class="ot">&lt;-</span> <span class="fu">with</span>(mice_obj, <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2_NA))</span>
<span id="cb17-341"><a href="#cb17-341"></a>    pooled_res <span class="ot">&lt;-</span> <span class="fu">pool</span>(mi_mods)</span>
<span id="cb17-342"><a href="#cb17-342"></a>    summ_pooled_res <span class="ot">&lt;-</span> <span class="fu">summary</span>(pooled_res, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb17-343"><a href="#cb17-343"></a>    ci_multiple_lower <span class="ot">&lt;-</span> summ_pooled_res <span class="sc">|&gt;</span> <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"x2_NA"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>)</span>
<span id="cb17-344"><a href="#cb17-344"></a>    ci_multiple_upper <span class="ot">&lt;-</span> summ_pooled_res <span class="sc">|&gt;</span> <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">"x2_NA"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>)</span>
<span id="cb17-345"><a href="#cb17-345"></a>    </span>
<span id="cb17-346"><a href="#cb17-346"></a>    <span class="co"># Store CI information</span></span>
<span id="cb17-347"><a href="#cb17-347"></a>    ci_list[[i]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-348"><a href="#cb17-348"></a>        <span class="at">ci_lower =</span> <span class="fu">c</span>(</span>
<span id="cb17-349"><a href="#cb17-349"></a>            ci_single[<span class="dv">1</span>],</span>
<span id="cb17-350"><a href="#cb17-350"></a>            ci_multiple_lower</span>
<span id="cb17-351"><a href="#cb17-351"></a>        ),</span>
<span id="cb17-352"><a href="#cb17-352"></a>        <span class="at">ci_upper =</span> <span class="fu">c</span>(</span>
<span id="cb17-353"><a href="#cb17-353"></a>            ci_single[<span class="dv">2</span>],</span>
<span id="cb17-354"><a href="#cb17-354"></a>            ci_multiple_upper</span>
<span id="cb17-355"><a href="#cb17-355"></a>        ),</span>
<span id="cb17-356"><a href="#cb17-356"></a>        <span class="at">which_imp =</span> <span class="fu">c</span>(<span class="st">"single"</span>, <span class="st">"multiple"</span>)</span>
<span id="cb17-357"><a href="#cb17-357"></a>    )</span>
<span id="cb17-358"><a href="#cb17-358"></a>}</span>
<span id="cb17-359"><a href="#cb17-359"></a>})</span>
<span id="cb17-360"><a href="#cb17-360"></a><span class="in">```</span></span>
<span id="cb17-361"><a href="#cb17-361"></a></span>
<span id="cb17-362"><a href="#cb17-362"></a>Below we compute the confidence interval (CI) coverage probability (fraction of times the CI contains the true value of <span class="in">`1`</span>) for the CIs generated from single and multiple imputation:</span>
<span id="cb17-363"><a href="#cb17-363"></a></span>
<span id="cb17-364"><a href="#cb17-364"></a><span class="in">```{r mult_single_sim_study_summ}</span></span>
<span id="cb17-365"><a href="#cb17-365"></a>ci_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ci_list)</span>
<span id="cb17-366"><a href="#cb17-366"></a>ci_data <span class="sc">|&gt;</span> </span>
<span id="cb17-367"><a href="#cb17-367"></a>    <span class="fu">mutate</span>(<span class="at">contains_truth =</span> ci_lower <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> ci_upper <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-368"><a href="#cb17-368"></a>    <span class="fu">group_by</span>(which_imp) <span class="sc">|&gt;</span> </span>
<span id="cb17-369"><a href="#cb17-369"></a>    <span class="fu">summarize</span>(<span class="at">frac_contains_truth =</span> <span class="fu">mean</span>(contains_truth))</span>
<span id="cb17-370"><a href="#cb17-370"></a><span class="in">```</span></span>
<span id="cb17-371"><a href="#cb17-371"></a></span>
<span id="cb17-372"><a href="#cb17-372"></a><span class="fu">## Done!</span></span>
<span id="cb17-373"><a href="#cb17-373"></a></span>
<span id="cb17-374"><a href="#cb17-374"></a><span class="ss">- </span>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>